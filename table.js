const jsonData = [
  {
    "PRIMARY": "11447",
    "BOROUGH": 1,
    "NEIGHBORHOOD": "TRIBECA",
    "BUILDING CLASS CATEGORY": "13 CONDOS - ELEVATOR APARTMENTS",
    "BLOCK": 179,
    "LOT": 1302,
    "BUILDING CLASS AT PRESENT": "R4",
    "ADDRESS": "18 LEONARD STREET",
    "ZIP CODE": 10013,
    "RESIDENTIAL UNITS": 1,
    "COMMERCIAL UNITS": 0,
    "LAND SQUARE FEET": 0,
    "GROSS SQUARE FEET": 0,
    "YEAR BUILT": 0,
    "TAX CLASS AT TIME OF SALE": 2,
    "BUILDING CLASS AT TIME OF SALE": "R4",
    "SALE PRICE": 1000,
    "SALE DATE": "2017-08-01"
  },
  {
    "PRIMARY": "11449",
    "BOROUGH": 1,
    "NEIGHBORHOOD": "TRIBECA",
    "BUILDING CLASS CATEGORY": "13 CONDOS - ELEVATOR APARTMENTS",
    "BLOCK": 180,
    "LOT": 1330,
    "BUILDING CLASS AT PRESENT": "R4",
    "ADDRESS": "345 GREENWICH STREET",
    "ZIP CODE": 10013,
    "RESIDENTIAL UNITS": 1,
    "COMMERCIAL UNITS": 0,
    "LAND SQUARE FEET": 0,
    "GROSS SQUARE FEET": 0,
    "YEAR BUILT": 0,
    "TAX CLASS AT TIME OF SALE": 2,
    "BUILDING CLASS AT TIME OF SALE": "R4",
    "SALE PRICE": 1000,
    "SALE DATE": "2017-06-28"
  },
  {
    "PRIMARY": "11450",
    "BOROUGH": 1,
    "NEIGHBORHOOD": "TRIBECA",
    "BUILDING CLASS CATEGORY": "13 CONDOS - ELEVATOR APARTMENTS",
    "BLOCK": 180,
    "LOT": 1708,
    "BUILDING CLASS AT PRESENT": "R4",
    "ADDRESS": "7 HARRISON STREET",
    "ZIP CODE": 10013,
    "RESIDENTIAL UNITS": 1,
    "COMMERCIAL UNITS": 0,
    "LAND SQUARE FEET": 0,
    "GROSS SQUARE FEET": 0,
    "YEAR BUILT": 1900,
    "TAX CLASS AT TIME OF SALE": 2,
    "BUILDING CLASS AT TIME OF SALE": "R4",
    "SALE PRICE": 1000,
    "SALE DATE": "2017-02-06"
  },
  {
    "PRIMARY": "11451",
    "BOROUGH": 1,
    "NEIGHBORHOOD": "TRIBECA",
    "BUILDING CLASS CATEGORY": "13 CONDOS - ELEVATOR APARTMENTS",
    "BLOCK": 180,
    "LOT": 1711,
    "BUILDING CLASS AT PRESENT": "R4",
    "ADDRESS": "7 HARRISON STREET",
    "ZIP CODE": 10013,
    "RESIDENTIAL UNITS": 1,
    "COMMERCIAL UNITS": 0,
    "LAND SQUARE FEET": 0,
    "GROSS SQUARE FEET": 0,
    "YEAR BUILT": 1900,
    "TAX CLASS AT TIME OF SALE": 2,
    "BUILDING CLASS AT TIME OF SALE": "R4",
    "SALE PRICE": 1000,
    "SALE DATE": "2016-11-18"
  },
  {
    "PRIMARY": "11452",
    "BOROUGH": 1,
    "NEIGHBORHOOD": "TRIBECA",
    "BUILDING CLASS CATEGORY": "13 CONDOS - ELEVATOR APARTMENTS",
    "BLOCK": 188,
    "LOT": 1108,
    "BUILDING CLASS AT PRESENT": "R4",
    "ADDRESS": "62 BEACH STREET",
    "ZIP CODE": 10013,
    "RESIDENTIAL UNITS": 1,
    "COMMERCIAL UNITS": 0,
    "LAND SQUARE FEET": 0,
    "GROSS SQUARE FEET": 0,
    "YEAR BUILT": 0,
    "TAX CLASS AT TIME OF SALE": 2,
    "BUILDING CLASS AT TIME OF SALE": "R4",
    "SALE PRICE": 1000,
    "SALE DATE": "2017-05-02"
  },
  {
    "PRIMARY": "11453",
    "BOROUGH": 1,
    "NEIGHBORHOOD": "TRIBECA",
    "BUILDING CLASS CATEGORY": "13 CONDOS - ELEVATOR APARTMENTS",
    "BLOCK": 188,
    "LOT": 1117,
    "BUILDING CLASS AT PRESENT": "R4",
    "ADDRESS": "62 BEACH STREET",
    "ZIP CODE": 10013,
    "RESIDENTIAL UNITS": 1,
    "COMMERCIAL UNITS": 0,
    "LAND SQUARE FEET": 0,
    "GROSS SQUARE FEET": 0,
    "YEAR BUILT": 0,
    "TAX CLASS AT TIME OF SALE": 2,
    "BUILDING CLASS AT TIME OF SALE": "R4",
    "SALE PRICE": 1000,
    "SALE DATE": "2016-11-30"
  },
  {
    "PRIMARY": "11454",
    "BOROUGH": 1,
    "NEIGHBORHOOD": "TRIBECA",
    "BUILDING CLASS CATEGORY": "13 CONDOS - ELEVATOR APARTMENTS",
    "BLOCK": 188,
    "LOT": 1206,
    "BUILDING CLASS AT PRESENT": "R4",
    "ADDRESS": "53 NORTH MOORE STREET",
    "ZIP CODE": 10013,
    "RESIDENTIAL UNITS": 1,
    "COMMERCIAL UNITS": 0,
    "LAND SQUARE FEET": 0,
    "GROSS SQUARE FEET": 0,
    "YEAR BUILT": 0,
    "TAX CLASS AT TIME OF SALE": 2,
    "BUILDING CLASS AT TIME OF SALE": "R4",
    "SALE PRICE": 1000,
    "SALE DATE": "2017-02-21"
  },
  {
    "PRIMARY": "11455",
    "BOROUGH": 1,
    "NEIGHBORHOOD": "TRIBECA",
    "BUILDING CLASS CATEGORY": "13 CONDOS - ELEVATOR APARTMENTS",
    "BLOCK": 188,
    "LOT": 1207,
    "BUILDING CLASS AT PRESENT": "R4",
    "ADDRESS": "53 NORTH MOORE STREET",
    "ZIP CODE": 10013,
    "RESIDENTIAL UNITS": 1,
    "COMMERCIAL UNITS": 0,
    "LAND SQUARE FEET": 0,
    "GROSS SQUARE FEET": 0,
    "YEAR BUILT": 0,
    "TAX CLASS AT TIME OF SALE": 2,
    "BUILDING CLASS AT TIME OF SALE": "R4",
    "SALE PRICE": 1000,
    "SALE DATE": "2017-07-27"
  },
  {
    "PRIMARY": "11456",
    "BOROUGH": 1,
    "NEIGHBORHOOD": "TRIBECA",
    "BUILDING CLASS CATEGORY": "13 CONDOS - ELEVATOR APARTMENTS",
    "BLOCK": 188,
    "LOT": 1218,
    "BUILDING CLASS AT PRESENT": "R4",
    "ADDRESS": "53 NORTH MOORE STREET",
    "ZIP CODE": 10013,
    "RESIDENTIAL UNITS": 1,
    "COMMERCIAL UNITS": 0,
    "LAND SQUARE FEET": 0,
    "GROSS SQUARE FEET": 0,
    "YEAR BUILT": 0,
    "TAX CLASS AT TIME OF SALE": 2,
    "BUILDING CLASS AT TIME OF SALE": "R4",
    "SALE PRICE": 1000,
    "SALE DATE": "2017-01-13"
  },{
    "PRIMARY": "15580",
    "BOROUGH": 1,
    "NEIGHBORHOOD": "UPPER WEST SIDE (59-79)",
    "BUILDING CLASS CATEGORY": "13 CONDOS - ELEVATOR APARTMENTS",
    "BLOCK": 1114,
    "LOT": 1086,
    "BUILDING CLASS AT PRESENT": "R4",
    "ADDRESS": "43 WEST 61ST STREET",
    "ZIP CODE": 10023,
    "RESIDENTIAL UNITS": 1,
    "COMMERCIAL UNITS": 0,
    "LAND SQUARE FEET": 0,
    "GROSS SQUARE FEET": 0,
    "YEAR BUILT": 1930,
    "TAX CLASS AT TIME OF SALE": 2,
    "BUILDING CLASS AT TIME OF SALE": "R4",
    "SALE PRICE": 180000,
    "SALE DATE": "2016-10-28"
  },
  {
    "PRIMARY": "15581",
    "BOROUGH": 1,
    "NEIGHBORHOOD": "UPPER WEST SIDE (59-79)",
    "BUILDING CLASS CATEGORY": "13 CONDOS - ELEVATOR APARTMENTS",
    "BLOCK": 1114,
    "LOT": 1104,
    "BUILDING CLASS AT PRESENT": "R4",
    "ADDRESS": "62 WEST 62ND STREET",
    "ZIP CODE": 10023,
    "RESIDENTIAL UNITS": 1,
    "COMMERCIAL UNITS": 0,
    "LAND SQUARE FEET": 0,
    "GROSS SQUARE FEET": 0,
    "YEAR BUILT": 0,
    "TAX CLASS AT TIME OF SALE": 2,
    "BUILDING CLASS AT TIME OF SALE": "R4",
    "SALE PRICE": 180000,
    "SALE DATE": "2017-06-01"
  },
  {
    "PRIMARY": "15582",
    "BOROUGH": 1,
    "NEIGHBORHOOD": "UPPER WEST SIDE (59-79)",
    "BUILDING CLASS CATEGORY": "13 CONDOS - ELEVATOR APARTMENTS",
    "BLOCK": 1114,
    "LOT": 1152,
    "BUILDING CLASS AT PRESENT": "R4",
    "ADDRESS": "62 WEST 62ND STREET",
    "ZIP CODE": 10023,
    "RESIDENTIAL UNITS": 1,
    "COMMERCIAL UNITS": 0,
    "LAND SQUARE FEET": 0,
    "GROSS SQUARE FEET": 0,
    "YEAR BUILT": 0,
    "TAX CLASS AT TIME OF SALE": 2,
    "BUILDING CLASS AT TIME OF SALE": "R4",
    "SALE PRICE": 180000,
    "SALE DATE": "2017-03-24"
  },
  {
    "PRIMARY": "15583",
    "BOROUGH": 1,
    "NEIGHBORHOOD": "UPPER WEST SIDE (59-79)",
    "BUILDING CLASS CATEGORY": "13 CONDOS - ELEVATOR APARTMENTS",
    "BLOCK": 1114,
    "LOT": 1158,
    "BUILDING CLASS AT PRESENT": "R4",
    "ADDRESS": "62 WEST 62ND ST",
    "ZIP CODE": 10023,
    "RESIDENTIAL UNITS": 1,
    "COMMERCIAL UNITS": 0,
    "LAND SQUARE FEET": 0,
    "GROSS SQUARE FEET": 0,
    "YEAR BUILT": 0,
    "TAX CLASS AT TIME OF SALE": 2,
    "BUILDING CLASS AT TIME OF SALE": "R4",
    "SALE PRICE": 180000,
    "SALE DATE": "2016-10-05"
  },
  {
    "PRIMARY": "15584",
    "BOROUGH": 1,
    "NEIGHBORHOOD": "UPPER WEST SIDE (59-79)",
    "BUILDING CLASS CATEGORY": "13 CONDOS - ELEVATOR APARTMENTS",
    "BLOCK": 1114,
    "LOT": 1198,
    "BUILDING CLASS AT PRESENT": "R4",
    "ADDRESS": "62 WEST 62ND STREET",
    "ZIP CODE": 10023,
    "RESIDENTIAL UNITS": 1,
    "COMMERCIAL UNITS": 0,
    "LAND SQUARE FEET": 0,
    "GROSS SQUARE FEET": 0,
    "YEAR BUILT": 0,
    "TAX CLASS AT TIME OF SALE": 2,
    "BUILDING CLASS AT TIME OF SALE": "R4",
    "SALE PRICE": 180000,
    "SALE DATE": "2017-04-28"
  },
  {
    "PRIMARY": "15585",
    "BOROUGH": 1,
    "NEIGHBORHOOD": "UPPER WEST SIDE (59-79)",
    "BUILDING CLASS CATEGORY": "13 CONDOS - ELEVATOR APARTMENTS",
    "BLOCK": 1114,
    "LOT": 1219,
    "BUILDING CLASS AT PRESENT": "R4",
    "ADDRESS": "62 WEST 62ND STREET",
    "ZIP CODE": 10023,
    "RESIDENTIAL UNITS": 1,
    "COMMERCIAL UNITS": 0,
    "LAND SQUARE FEET": 0,
    "GROSS SQUARE FEET": 0,
    "YEAR BUILT": 0,
    "TAX CLASS AT TIME OF SALE": 2,
    "BUILDING CLASS AT TIME OF SALE": "R4",
    "SALE PRICE": 180000,
    "SALE DATE": "2017-07-25"
  },
  {
    "PRIMARY": "15586",
    "BOROUGH": 1,
    "NEIGHBORHOOD": "UPPER WEST SIDE (59-79)",
    "BUILDING CLASS CATEGORY": "13 CONDOS - ELEVATOR APARTMENTS",
    "BLOCK": 1114,
    "LOT": 1324,
    "BUILDING CLASS AT PRESENT": "R4",
    "ADDRESS": "15 CENTRAL PARK WEST",
    "ZIP CODE": 10023,
    "RESIDENTIAL UNITS": 1,
    "COMMERCIAL UNITS": 0,
    "LAND SQUARE FEET": 0,
    "GROSS SQUARE FEET": 0,
    "YEAR BUILT": 2005,
    "TAX CLASS AT TIME OF SALE": 2,
    "BUILDING CLASS AT TIME OF SALE": "R4",
    "SALE PRICE": 180000,
    "SALE DATE": "2016-09-27"
  },
  {
    "PRIMARY": "15587",
    "BOROUGH": 1,
    "NEIGHBORHOOD": "UPPER WEST SIDE (59-79)",
    "BUILDING CLASS CATEGORY": "13 CONDOS - ELEVATOR APARTMENTS",
    "BLOCK": 1114,
    "LOT": 1332,
    "BUILDING CLASS AT PRESENT": "R4",
    "ADDRESS": "15 CENTRAL PARK WEST",
    "ZIP CODE": 10023,
    "RESIDENTIAL UNITS": 1,
    "COMMERCIAL UNITS": 0,
    "LAND SQUARE FEET": 0,
    "GROSS SQUARE FEET": 0,
    "YEAR BUILT": 2005,
    "TAX CLASS AT TIME OF SALE": 2,
    "BUILDING CLASS AT TIME OF SALE": "R4",
    "SALE PRICE": 180000,
    "SALE DATE": "2016-12-28"
  },
  {
    "PRIMARY": "15588",
    "BOROUGH": 1,
    "NEIGHBORHOOD": "UPPER WEST SIDE (59-79)",
    "BUILDING CLASS CATEGORY": "13 CONDOS - ELEVATOR APARTMENTS",
    "BLOCK": 1114,
    "LOT": 1408,
    "BUILDING CLASS AT PRESENT": "R4",
    "ADDRESS": "15 CENTRAL PARK WEST",
    "ZIP CODE": 10023,
    "RESIDENTIAL UNITS": 1,
    "COMMERCIAL UNITS": 0,
    "LAND SQUARE FEET": 0,
    "GROSS SQUARE FEET": 0,
    "YEAR BUILT": 2005,
    "TAX CLASS AT TIME OF SALE": 2,
    "BUILDING CLASS AT TIME OF SALE": "R4",
    "SALE PRICE": 180000,
    "SALE DATE": "2017-03-01"
  },
  {
    "PRIMARY": "15589",
    "BOROUGH": 1,
    "NEIGHBORHOOD": "UPPER WEST SIDE (59-79)",
    "BUILDING CLASS CATEGORY": "13 CONDOS - ELEVATOR APARTMENTS",
    "BLOCK": 1114,
    "LOT": 1408,
    "BUILDING CLASS AT PRESENT": "R4",
    "ADDRESS": "15 CENTRAL PARK WEST",
    "ZIP CODE": 10023,
    "RESIDENTIAL UNITS": 1,
    "COMMERCIAL UNITS": 0,
    "LAND SQUARE FEET": 0,
    "GROSS SQUARE FEET": 0,
    "YEAR BUILT": 2005,
    "TAX CLASS AT TIME OF SALE": 2,
    "BUILDING CLASS AT TIME OF SALE": "R4",
    "SALE PRICE": 180000,
    "SALE DATE": "2017-01-24"
  },
  {
    "PRIMARY": "15590",
    "BOROUGH": 1,
    "NEIGHBORHOOD": "UPPER WEST SIDE (59-79)",
    "BUILDING CLASS CATEGORY": "13 CONDOS - ELEVATOR APARTMENTS",
    "BLOCK": 1114,
    "LOT": 1425,
    "BUILDING CLASS AT PRESENT": "R4",
    "ADDRESS": "15 CENTRAL PARK WEST",
    "ZIP CODE": 10023,
    "RESIDENTIAL UNITS": 1,
    "COMMERCIAL UNITS": 0,
    "LAND SQUARE FEET": 0,
    "GROSS SQUARE FEET": 0,
    "YEAR BUILT": 2005,
    "TAX CLASS AT TIME OF SALE": 2,
    "BUILDING CLASS AT TIME OF SALE": "R4",
    "SALE PRICE": 180000,
    "SALE DATE": "2017-01-12"
  },
];

let currentPage = 1;
const itemsPerPage = 8;
let filteredData = jsonData;
let selectedColumns = new Set(['ADDRESS','BOROUGH', 'NEIGHBORHOOD', 'BLOCK', 'BUILDING CLASS CATEGORY', 'SALE DATE', 'SALE PRICE']);

function createColumnFilters() {
  const columnFiltersDiv = document.getElementById('columnFilters');
  columnFiltersDiv.innerHTML = ''; // Clear existing filters
  Object.keys(jsonData[0]).forEach(header => {
    const checkbox = document.createElement('input');
    checkbox.type = 'checkbox';
    checkbox.id = header;
    checkbox.name = 'column';
    checkbox.value = header;
    checkbox.checked = selectedColumns.has(header);
    checkbox.onchange = toggleColumn;

    const label = document.createElement('label');
    label.htmlFor = header;
    label.textContent = header;

    // Create a div to contain the checkbox and the label
    const containerDiv = document.createElement('div');
    containerDiv.appendChild(checkbox);
    containerDiv.appendChild(label);

    columnFiltersDiv.appendChild(containerDiv);
  });

  // Disable checkboxes if limits are reached
  if (selectedColumns.size >= 8) {
    columnFiltersDiv.querySelectorAll('input[type="checkbox"]:not(:checked)').forEach(checkbox => {
      checkbox.disabled = true;
    });
  }
  if (selectedColumns.size <= 5) {
    columnFiltersDiv.querySelectorAll('input[type="checkbox"]:checked').forEach(checkbox => {
      checkbox.disabled = true;
    });
  }
}

function toggleColumn(event) {
  event.stopPropagation(); // Prevent dropdown from closing
  const column = event.target.value;
  if (event.target.checked) {
    if (selectedColumns.size < 8) {
      selectedColumns.add(column);
    }
  } else {
    if (selectedColumns.size > 5) {
      selectedColumns.delete(column);
    }
  }
  createColumnFilters(); // Update filters to reflect current state
  displayData(filteredData, currentPage);
}

function createTableHeaders() {
  const tableHeader = document.querySelector('#dataTable thead tr');
  tableHeader.innerHTML = '';
  Array.from(selectedColumns).forEach(header => {
    const th = document.createElement('th');
    th.textContent = header;
    tableHeader.appendChild(th);
  });
}

function displayData(data, page) {
  const startIndex = (page - 1) * itemsPerPage;
  const endIndex = startIndex + itemsPerPage;
  const paginatedItems = data.slice(startIndex, endIndex);

  createTableHeaders();

  const tableBody = document.querySelector('#dataTable tbody');
  tableBody.innerHTML = '';

  paginatedItems.forEach(item => {
    const tr = document.createElement('tr');
    Array.from(selectedColumns).forEach(column => {
      const td = document.createElement('td');
      td.textContent = item[column];
      tr.appendChild(td);
    });
    tableBody.appendChild(tr);
  });
}

function changePage(step) {
  const totalPages = Math.ceil(filteredData.length / itemsPerPage);
  currentPage += step;
  currentPage = Math.max(1, Math.min(currentPage, totalPages));

  displayData(filteredData, currentPage);
}

document.getElementById('searchInput').addEventListener('keyup', function() {
  const searchValue = this.value.toLowerCase();
  filteredData = jsonData.filter(item => 
    Array.from(selectedColumns).some(column => 
      String(item[column]).toLowerCase().includes(searchValue)
    )
  );
  currentPage = 1;
  changePage(0);
});

function toggleDropdown() {
  document.getElementById("columnFilters").classList.toggle("show");
}

// Close dropdown if user clicks outside of it
window.onclick = function(event) {
  if (!event.target.matches('.dropbtn') && !event.target.matches('[name="column"]')) {
    const dropdowns = document.getElementsByClassName("dropdown-content");
    for (let i = 0; i < dropdowns.length; i++) {
      const openDropdown = dropdowns[i];
      if (openDropdown.classList.contains('show')) {
        openDropdown.classList.remove('show');
      }
    }
  }
}

// Initialize
createColumnFilters();
displayData(filteredData, currentPage);

